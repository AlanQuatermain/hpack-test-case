# hpack-test-case

## Draft

http://tools.ietf.org/html/draft-ietf-httpbis-header-compression


## Directory

The ```raw-data``` directory has original stories of header data in
json.

Other than ```raw-data``` directory, the HPACK implementations have
their own directories to store the result of its encoder.

You can perform interoperability testing for your implementation with
them.

## File Name

Each json in story-#{n}.json is story case and shares compression
context. Each story is either series of requests or responses.

## JSON Format

Each json has:

- draft:   HPACK draft version number of implementation.
- context: "request" or "response".
- description: general description of encoding strategy or implementation.
- cases:   test cases.
  - seqno: a sequence number. 0 origin.
  - header_table_size : header table size adjusted before encoding/decoding the header set.
  - wire:    encoded wire data in hex string.
  - headers:  decoded http header in hash.

To test the decoder implementation, for each story file, for each case
in ```cases``` in the order they appear, decode compressed header
block in ```wire``` and verify the result against the header set in
```headers```. Please note that elements in ```cases``` share the same
compression context.

To test the encoder implementation, generate json story files by
encoding header sets in ```headers```. Using json files in
```raw-data``` is handy. Then use your decoder to verify that it can
successfully decode the compressed header block. If you can play with
other HPACK decoder implementations, try decoding your encoded data
with them. If there is any mismatch, then there must be a bug in
somewhere either encoder or decoder, or both.

```js
{
  "draft": 5,
  "context": "request",
  "description": "Encoded request headers with Literal without index only.",
  "cases": [
    {
      "seqno": 0,
      "header_table_size": 4096,
      "wire": "1234567890abcdef",
      "headers": [
        { ":method": "GET" },
        { ":scheme": "http" },
        { ":authority": "example.com" },
        { ":path": "/" },
        { "x-my-header": "value1,value2" }
      ]
    },
    .....
  ]
}
```

## Original Data

These Header Data are converted from https://github.com/http2/http_samples


## compression ratio

The each cell has ``X (Y/Z)`` format:

X
  Y / Z
Y
  number of bytes after compression
Z
  number of bytes before compression

| story          | go-hpack                     | haskell-http2                | haskell-http2-diff           | haskell-http2-diff-huffman   | haskell-http2-linear         | nghttp2                      | nghttp2-16384-4096           | haskell-http2-linear-huffman | haskell-http2-naive          | haskell-http2-naive-huffman  | node-http2-hpack             | node-http2-protocol          | twitter-hpack                | nghttp2-512                  | twitter-hpack-512            |
| -------------- | ---------------------------- | ---------------------------- | ---------------------------- | ---------------------------- | ---------------------------- | ---------------------------- | ---------------------------- | ---------------------------- | ---------------------------- | ---------------------------- | ---------------------------- | ---------------------------- | ---------------------------- | ---------------------------- | ---------------------------- |
| story\_00.json | 0.99 (182/183)               | 0.43 (79/183)                | 0.48 (87/183)                | 0.36 (65/183)                | 0.50 (92/183)                | 0.36 (65/183)                | 0.36 (65/183)                | 0.38 (70/183)                | 1.21 (222/183)               | 0.99 (182/183)               | 0.40 (74/183)                | 0.36 (65/183)                | 0.36 (65/183)                | 0.36 (65/183)                | 0.36 (65/183)                |
| story\_01.json | 1.02 (182/178)               | 0.47 (83/178)                | 0.37 (65/178)                | 0.31 (56/178)                | 0.39 (70/178)                | 0.31 (56/178)                | 0.31 (56/178)                | 0.34 (61/178)                | 1.23 (219/178)               | 1.02 (182/178)               | 0.31 (56/178)                | 0.31 (56/178)                | 0.31 (56/178)                | 0.31 (56/178)                | 0.31 (56/178)                |
| story\_02.json | 0.83 (2855/3456)             | 0.25 (868/3456)              | 0.26 (897/3456)              | 0.19 (653/3456)              | 0.28 (968/3456)              | 0.19 (653/3456)              | 0.19 (653/3456)              | 0.21 (724/3456)              | 1.09 (3760/3456)             | 0.83 (2855/3456)             | 0.20 (680/3456)              | 0.19 (660/3456)              | 0.19 (660/3456)              | 0.61 (2092/3456)             | 0.61 (2092/3456)             |
| story\_03.json | 0.85 (2638/3113)             | 0.21 (658/3113)              | 0.19 (590/3113)              | 0.14 (446/3113)              | 0.21 (660/3113)              | 0.14 (446/3113)              | 0.14 (446/3113)              | 0.17 (516/3113)              | 1.10 (3420/3113)             | 0.85 (2638/3113)             | 0.15 (455/3113)              | 0.14 (445/3113)              | 0.14 (445/3113)              | 0.45 (1409/3113)             | 0.60 (1872/3113)             |
| story\_04.json | 0.85 (2638/3113)             | 0.21 (658/3113)              | 0.19 (590/3113)              | 0.14 (446/3113)              | 0.21 (660/3113)              | 0.14 (446/3113)              | 0.14 (446/3113)              | 0.17 (516/3113)              | 1.10 (3420/3113)             | 0.85 (2638/3113)             | 0.15 (455/3113)              | 0.14 (445/3113)              | 0.14 (445/3113)              | 0.45 (1409/3113)             | 0.60 (1872/3113)             |
| story\_05.json | 0.84 (2914/3455)             | 0.21 (715/3455)              | 0.19 (667/3455)              | 0.15 (507/3455)              | 0.21 (738/3455)              | 0.15 (507/3455)              | 0.15 (507/3455)              | 0.17 (578/3455)              | 1.10 (3786/3455)             | 0.84 (2914/3455)             | 0.15 (514/3455)              | 0.15 (504/3455)              | 0.15 (504/3455)              | 0.61 (2107/3455)             | 0.61 (2107/3455)             |
| story\_06.json | 0.84 (2948/3489)             | 0.27 (928/3489)              | 0.29 (1013/3489)             | 0.23 (797/3489)              | 0.31 (1089/3489)             | 0.23 (797/3489)              | 0.23 (797/3489)              | 0.25 (873/3489)              | 1.09 (3798/3489)             | 0.84 (2948/3489)             | 0.24 (834/3489)              | 0.23 (805/3489)              | 0.23 (805/3489)              | 0.45 (1566/3489)             | 0.62 (2179/3489)             |
| story\_07.json | 0.84 (2687/3192)             | 0.25 (805/3192)              | 0.23 (733/3192)              | 0.18 (559/3192)              | 0.25 (802/3192)              | 0.18 (559/3192)              | 0.18 (559/3192)              | 0.20 (628/3192)              | 1.10 (3502/3192)             | 0.84 (2687/3192)             | 0.19 (593/3192)              | 0.18 (568/3192)              | 0.18 (568/3192)              | 0.60 (1916/3192)             | 0.60 (1916/3192)             |
| story\_08.json | 0.84 (3366/4006)             | 0.33 (1309/4006)             | 0.30 (1202/4006)             | 0.24 (942/4006)              | 0.32 (1262/4006)             | 0.24 (942/4006)              | 0.24 (942/4006)              | 0.25 (1002/4006)             | 1.08 (4339/4006)             | 0.84 (3366/4006)             | 0.24 (959/4006)              | 0.24 (949/4006)              | 0.24 (949/4006)              | 0.64 (2563/4006)             | 0.64 (2563/4006)             |
| story\_09.json | 0.84 (2771/3309)             | 0.25 (830/3309)              | 0.25 (817/3309)              | 0.19 (628/3309)              | 0.27 (884/3309)              | 0.19 (628/3309)              | 0.19 (628/3309)              | 0.21 (695/3309)              | 1.09 (3620/3309)             | 0.84 (2771/3309)             | 0.18 (581/3309)              | 0.17 (572/3309)              | 0.17 (572/3309)              | 0.48 (1585/3309)             | 0.61 (2002/3309)             |
| story\_10.json | 0.84 (2600/3078)             | 0.21 (635/3078)              | 0.21 (648/3078)              | 0.16 (489/3078)              | 0.23 (717/3078)              | 0.16 (489/3078)              | 0.16 (489/3078)              | 0.18 (558/3078)              | 1.10 (3382/3078)             | 0.84 (2600/3078)             | 0.16 (501/3078)              | 0.16 (487/3078)              | 0.16 (487/3078)              | 0.45 (1399/3078)             | 0.60 (1837/3078)             |
| story\_11.json | 0.83 (3069/3706)             | 0.24 (897/3706)              | 0.26 (975/3706)              | 0.19 (719/3706)              | 0.28 (1050/3706)             | 0.19 (719/3706)              | 0.19 (719/3706)              | 0.21 (794/3706)              | 1.09 (4040/3706)             | 0.83 (3069/3706)             | 0.20 (732/3706)              | 0.19 (712/3706)              | 0.19 (712/3706)              | 0.41 (1523/3706)             | 0.61 (2257/3706)             |
| story\_12.json | 0.84 (4203/4975)             | 0.17 (825/4975)              | 0.18 (875/4975)              | 0.14 (677/4975)              | 0.19 (968/4975)              | 0.14 (677/4975)              | 0.14 (677/4975)              | 0.15 (770/4975)              | 1.07 (5318/4975)             | 0.84 (4203/4975)             | 0.14 (720/4975)              | 0.14 (685/4975)              | 0.14 (685/4975)              | 0.68 (3391/4975)             | 0.68 (3391/4975)             |
| story\_13.json | 0.84 (2618/3104)             | 0.20 (633/3104)              | 0.21 (646/3104)              | 0.15 (477/3104)              | 0.23 (725/3104)              | 0.15 (477/3104)              | 0.15 (477/3104)              | 0.18 (556/3104)              | 1.10 (3411/3104)             | 0.84 (2618/3104)             | 0.16 (510/3104)              | 0.16 (485/3104)              | 0.16 (485/3104)              | 0.38 (1182/3104)             | 0.60 (1851/3104)             |
| story\_14.json | 0.84 (2611/3114)             | 0.21 (655/3114)              | 0.23 (728/3114)              | 0.17 (534/3114)              | 0.26 (799/3114)              | 0.17 (534/3114)              | 0.17 (534/3114)              | 0.19 (605/3114)              | 1.10 (3418/3114)             | 0.84 (2611/3114)             | 0.18 (556/3114)              | 0.17 (542/3114)              | 0.17 (542/3114)              | 0.41 (1264/3114)             | 0.59 (1848/3114)             |
| story\_15.json | 0.84 (2563/3046)             | 0.19 (578/3046)              | 0.18 (562/3046)              | 0.14 (425/3046)              | 0.21 (634/3046)              | 0.14 (425/3046)              | 0.14 (425/3046)              | 0.16 (497/3046)              | 1.10 (3347/3046)             | 0.84 (2563/3046)             | 0.14 (436/3046)              | 0.14 (431/3046)              | 0.14 (431/3046)              | 0.43 (1296/3046)             | 0.59 (1802/3046)             |
| story\_16.json | 0.82 (3440/4189)             | 0.26 (1077/4189)             | 0.29 (1213/4189)             | 0.22 (911/4189)              | 0.31 (1278/4189)             | 0.22 (911/4189)              | 0.22 (911/4189)              | 0.23 (976/4189)              | 1.08 (4533/4189)             | 0.82 (3440/4189)             | 0.20 (836/4189)              | 0.20 (823/4189)              | 0.20 (823/4189)              | 0.61 (2543/4189)             | 0.61 (2543/4189)             |
| story\_17.json | 0.84 (2702/3233)             | 0.22 (709/3233)              | 0.23 (757/3233)              | 0.17 (548/3233)              | 0.26 (829/3233)              | 0.17 (548/3233)              | 0.17 (548/3233)              | 0.19 (620/3233)              | 1.10 (3546/3233)             | 0.84 (2702/3233)             | 0.18 (579/3233)              | 0.17 (555/3233)              | 0.17 (555/3233)              | 0.60 (1924/3233)             | 0.60 (1924/3233)             |
| story\_18.json | 0.83 (2879/3457)             | 0.24 (838/3457)              | 0.25 (848/3457)              | 0.18 (632/3457)              | 0.26 (909/3457)              | 0.18 (632/3457)              | 0.18 (632/3457)              | 0.20 (693/3457)              | 1.09 (3773/3457)             | 0.83 (2879/3457)             | 0.19 (644/3457)              | 0.18 (639/3457)              | 0.18 (639/3457)              | 0.58 (1996/3457)             | 0.61 (2096/3457)             |
| story\_19.json | 0.85 (2820/3321)             | 0.26 (873/3321)              | 0.24 (813/3321)              | 0.19 (643/3321)              | 0.26 (878/3321)              | 0.19 (643/3321)              | 0.19 (643/3321)              | 0.21 (708/3321)              | 1.09 (3631/3321)             | 0.85 (2820/3321)             | 0.20 (675/3321)              | 0.20 (651/3321)              | 0.20 (651/3321)              | 0.47 (1548/3321)             | 0.62 (2048/3321)             |
| story\_20.json | 0.82 (52560/63971)           | 0.23 (14930/63971)           | 0.16 (10243/63971)           | 0.12 (7472/63971)            | 0.18 (11435/63971)           | 0.12 (7461/63971)            | 0.12 (7471/63971)            | 0.14 (8664/63971)            | 1.08 (69184/63971)           | 0.82 (52560/63971)           | 0.14 (9109/63971)            | 0.14 (8695/63971)            | 0.14 (8695/63971)            | 0.62 (39389/63971)           | 0.62 (39743/63971)           |
| story\_21.json | 0.86 (126884/147841)         | 0.40 (59079/147841)          | 0.47 (69400/147841)          | 0.37 (54520/147841)          | 0.47 (69613/147841)          | 0.37 (54502/147841)          | 0.37 (55281/147841)          | 0.37 (54733/147841)          | 1.10 (162204/147841)         | 0.86 (126884/147841)         | 0.37 (54204/147841)          | 0.37 (54098/147841)          | 0.37 (54098/147841)          | 0.65 (96673/147841)          | 0.66 (96975/147841)          |
| story\_22.json | 0.84 (94840/112819)          | 0.30 (34277/112819)          | 0.34 (38153/112819)          | 0.24 (27588/112819)          | 0.35 (39098/112819)          | 0.24 (27578/112819)          | 0.25 (27969/112819)          | 0.25 (28533/112819)          | 1.12 (126406/112819)         | 0.84 (94840/112819)          | 0.25 (28565/112819)          | 0.25 (27926/112819)          | 0.25 (27926/112819)          | 0.41 (46410/112819)          | 0.45 (51134/112819)          |
| story\_23.json | 0.87 (94046/108675)          | 0.43 (46340/108675)          | 0.47 (51289/108675)          | 0.36 (39180/108675)          | 0.47 (51026/108675)          | 0.36 (39112/108675)          | 0.37 (39746/108675)          | 0.36 (38917/108675)          | 1.11 (121036/108675)         | 0.87 (94046/108675)          | 0.36 (39231/108675)          | 0.36 (39047/108675)          | 0.36 (39047/108675)          | 0.55 (59557/108675)          | 0.56 (61207/108675)          |
| story\_24.json | 0.86 (8089/9458)             | 0.34 (3236/9458)             | 0.37 (3462/9458)             | 0.26 (2458/9458)             | 0.37 (3543/9458)             | 0.26 (2455/9458)             | 0.26 (2462/9458)             | 0.27 (2539/9458)             | 1.11 (10541/9458)            | 0.86 (8089/9458)             | 0.26 (2486/9458)             | 0.26 (2474/9458)             | 0.26 (2474/9458)             | 0.54 (5073/9458)             | 0.54 (5073/9458)             |
| story\_25.json | 0.84 (60107/71264)           | 0.39 (27757/71264)           | 0.44 (31328/71264)           | 0.33 (23188/71264)           | 0.44 (31341/71264)           | 0.33 (23169/71264)           | 0.33 (23566/71264)           | 0.33 (23201/71264)           | 1.11 (79141/71264)           | 0.84 (60107/71264)           | 0.33 (23739/71264)           | 0.33 (23647/71264)           | 0.33 (23647/71264)           | 0.49 (34661/71264)           | 0.53 (37971/71264)           |
| story\_26.json | 0.86 (32001/37215)           | 0.35 (13126/37215)           | 0.39 (14612/37215)           | 0.30 (11256/37215)           | 0.40 (14875/37215)           | 0.30 (11248/37215)           | 0.31 (11401/37215)           | 0.31 (11519/37215)           | 1.11 (41298/37215)           | 0.86 (32001/37215)           | 0.31 (11396/37215)           | 0.31 (11388/37215)           | 0.31 (11388/37215)           | 0.54 (19996/37215)           | 0.55 (20423/37215)           |
| story\_27.json | 0.85 (113359/133117)         | 0.36 (47521/133117)          | 0.39 (51994/133117)          | 0.30 (39994/133117)          | 0.39 (51883/133117)          | 0.30 (39982/133117)          | 0.30 (40443/133117)          | 0.30 (39883/133117)          | 1.07 (142573/133117)         | 0.85 (113359/133117)         | 0.31 (40829/133117)          | 0.31 (40816/133117)          | 0.31 (40816/133117)          | 0.71 (94918/133117)          | 0.72 (95220/133117)          |
| story\_28.json | 0.87 (37431/42824)           | 0.41 (17545/42824)           | 0.42 (18091/42824)           | 0.33 (14052/42824)           | 0.42 (18012/42824)           | 0.33 (14032/42824)           | 0.33 (14249/42824)           | 0.33 (13973/42824)           | 1.12 (47749/42824)           | 0.87 (37431/42824)           | 0.33 (14177/42824)           | 0.33 (14143/42824)           | 0.33 (14143/42824)           | 0.57 (24221/42824)           | 0.59 (25388/42824)           |
| story\_29.json | 0.87 (102255/117127)         | 0.42 (49353/117127)          | 0.44 (51127/117127)          | 0.34 (39768/117127)          | 0.44 (51052/117127)          | 0.34 (39708/117127)          | 0.34 (40373/117127)          | 0.34 (39693/117127)          | 1.11 (129935/117127)         | 0.87 (102255/117127)         | 0.35 (41485/117127)          | 0.35 (41393/117127)          | 0.35 (41393/117127)          | 0.62 (72630/117127)          | 0.64 (74535/117127)          |
| story\_30.json | 0.88 (191244/218129)         | 0.36 (78817/218129)          | 0.38 (83445/218129)          | 0.30 (64801/218129)          | 0.39 (85125/218129)          | 0.30 (64727/218129)          | 0.30 (65898/218129)          | 0.30 (66481/218129)          | 1.12 (244536/218129)         | 0.88 (191244/218129)         | 0.30 (65881/218129)          | 0.30 (65505/218129)          | 0.30 (65505/218129)          | 0.58 (125798/218129)         | 0.58 (127178/218129)         |
| Overall        | 0.86 (965502/1125157)        | 0.36 (406634/1125157)        | 0.39 (437870/1125157)        | 0.30 (335431/1125157)        | 0.39 (443015/1125157)        | 0.30 (335128/1125157)        | 0.30 (340013/1125157)        | 0.30 (340576/1125157)        | 1.10 (1243088/1125157)       | 0.86 (965502/1125157)        | 0.30 (342492/1125157)        | 0.30 (340211/1125157)        | 0.30 (340211/1125157)        | 0.58 (652160/1125157)        | 0.60 (673168/1125157)        |


## Contributor

- jxck
- summerwind
- kazu-yamamoto
- tatsuhiro-t


## License

The MIT License (MIT)
Copyright (c) 2013 Jxck
